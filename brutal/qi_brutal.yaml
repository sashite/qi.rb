---
header: |
  # frozen_string_literal: true

  require "simplecov"

  ::SimpleCov.command_name "Brutal test suite"
  ::SimpleCov.start

  begin
    require_relative "../lib/qi"
  rescue ::LoadError
    require "../lib/qi"
  end

  STARTING_POSITION_CONTEXT = [
    false,
    [],
    [],
    {
       0 => "l",
       1 => "n",
       2 => "s",
       3 => "g",
       4 => "k",
       5 => "g",
       6 => "s",
       7 => "n",
       8 => "l",
      10 => "r",
      16 => "b",
      18 => "p",
      19 => "p",
      20 => "p",
      21 => "p",
      22 => "p",
      23 => "p",
      24 => "p",
      25 => "p",
      26 => "p",
      54 => "P",
      55 => "P",
      56 => "P",
      57 => "P",
      58 => "P",
      59 => "P",
      60 => "P",
      61 => "P",
      62 => "P",
      64 => "B",
      70 => "R",
      72 => "L",
      73 => "N",
      74 => "S",
      75 => "G",
      76 => "K",
      77 => "G",
      78 => "S",
      79 => "N",
      80 => "L"
    },
    false
  ].freeze

subject: |
  starting_position = Qi.new(*STARTING_POSITION_CONTEXT)

  %{moves}.reduce(starting_position) do |position, args|
    position.commit(*args.first(2), **Hash(args[2]).transform_keys(&:to_sym))
  end

contexts:
  moves:
    - []
    -
      - [{56: null, 47: "P"}, null, {is_drop: null, is_in_check: false}]
    -
      - [{56: null, 47: "P"}, null, {is_drop: null, is_in_check: false}]
      - [{3: null, 11: "g"}, null, {is_drop: null, is_in_check: false}]
    -
      - [{56: null, 47: "P"}, null, {is_drop: null, is_in_check: false}]
      - [{3: null, 11: "g"}, null, {is_drop: null, is_in_check: false}]
      - [{64: null, 24: "+B"}, "P", {is_drop: false, is_in_check: false}]
    -
      - [{56: null, 47: "P"}, null, {is_drop: null, is_in_check: false}]
      - [{3: null, 11: "g"}, null, {is_drop: null, is_in_check: false}]
      - [{64: null, 24: "+B"}, "P", {is_drop: false, is_in_check: false}]
      - [{5: null, 14: "g"}, null, {is_drop: null, is_in_check: false}]
    -
      - [{56: null, 47: "P"}, null, {is_drop: null, is_in_check: false}]
      - [{3: null, 11: "g"}, null, {is_drop: null, is_in_check: false}]
      - [{64: null, 24: "+B"}, "P", {is_drop: false, is_in_check: false}]
      - [{5: null, 14: "g"}, null, {is_drop: null, is_in_check: false}]
      - [{24: null, 14: "+B"}, "G", {is_drop: false, is_in_check: false}]
    -
      - [{56: null, 47: "P"}, null, {is_drop: null, is_in_check: false}]
      - [{3: null, 11: "g"}, null, {is_drop: null, is_in_check: false}]
      - [{64: null, 24: "+B"}, "P", {is_drop: false, is_in_check: false}]
      - [{5: null, 14: "g"}, null, {is_drop: null, is_in_check: false}]
      - [{24: null, 14: "+B"}, "G", {is_drop: false, is_in_check: false}]
      - [{4: null, 3: "k"}, null, {is_drop: null, is_in_check: false}]
    -
      - [{56: null, 47: "P"}, null, {is_drop: null, is_in_check: false}]
      - [{3: null, 11: "g"}, null, {is_drop: null, is_in_check: false}]
      - [{64: null, 24: "+B"}, "P", {is_drop: false, is_in_check: false}]
      - [{5: null, 14: "g"}, null, {is_drop: null, is_in_check: false}]
      - [{24: null, 14: "+B"}, "G", {is_drop: false, is_in_check: false}]
      - [{4: null, 3: "k"}, null, {is_drop: null, is_in_check: false}]
      - [{13: "G"}, "G", {is_drop: true, is_in_check: false}]

actuals:
  - "%{subject}.north_captures"
  - "%{subject}.south_captures"
  - "%{subject}.squares"
  - "(%{subject} == Qi.new(*STARTING_POSITION_CONTEXT))"
  - "%{subject}.eql?(Qi.new(*STARTING_POSITION_CONTEXT))"
  - "%{subject}.current_captures"
  - "%{subject}.opponent_captures"
  - "%{subject}.current_turn"
  - "%{subject}.next_turn"
  - "%{subject}.north_turn?"
  - "%{subject}.south_turn?"
  - "%{subject}.in_check?"
  - "%{subject}.not_in_check?"
  - "%{subject}.to_a"
  - "%{subject}.to_h"
  - "%{subject}.hash"
  - "%{subject}.board_pieces"
  - "%{subject}.serialize"
  - "%{subject}.inspect"
