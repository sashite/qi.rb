---
header: |
  # frozen_string_literal: true

  require "simplecov"

  ::SimpleCov.command_name "Brutal test suite"
  ::SimpleCov.start

  begin
    require_relative "../lib/qi"
  rescue ::LoadError
    require "../lib/qi"
  end

  STARTING_POSITION_CONTEXT = [
    false,
    [],
    [],
    {
       0 => "l",
       1 => "n",
       2 => "s",
       3 => "g",
       4 => "k",
       5 => "g",
       6 => "s",
       7 => "n",
       8 => "l",
      10 => "r",
      16 => "b",
      18 => "p",
      19 => "p",
      20 => "p",
      21 => "p",
      22 => "p",
      23 => "p",
      24 => "p",
      25 => "p",
      26 => "p",
      54 => "P",
      55 => "P",
      56 => "P",
      57 => "P",
      58 => "P",
      59 => "P",
      60 => "P",
      61 => "P",
      62 => "P",
      64 => "B",
      70 => "R",
      72 => "L",
      73 => "N",
      74 => "S",
      75 => "G",
      76 => "K",
      77 => "G",
      78 => "S",
      79 => "N",
      80 => "L"
    }
  ].freeze

subject: |
  starting_position = Qi.new(*STARTING_POSITION_CONTEXT)

  %{moves}.reduce(starting_position) do |position, args|
    position.commit(*args)
  end

contexts:
  moves:
    - []
    -
      - [56, 47, "P", null]
    -
      - [56, 47, "P", null]
      - [3, 11, "g", null]
    -
      - [56, 47, "P", null]
      - [3, 11, "g", null]
      - [64, 24, "+B", "P"]
    -
      - [56, 47, "P", null]
      - [3, 11, "g", null]
      - [64, 24, "+B", "P"]
      - [5, 14, "g", null]
    -
      - [56, 47, "P", null]
      - [3, 11, "g", null]
      - [64, 24, "+B", "P"]
      - [5, 14, "g", null]
      - [24, 14, "+B", "G"]
    -
      - [56, 47, "P", null]
      - [3, 11, "g", null]
      - [64, 24, "+B", "P"]
      - [5, 14, "g", null]
      - [24, 14, "+B", "G"]
      - [4, 3, "k", null]
    -
      - [56, 47, "P", null]
      - [3, 11, "g", null]
      - [64, 24, "+B", "P"]
      - [5, 14, "g", null]
      - [24, 14, "+B", "G"]
      - [4, 3, "k", null]
      - [null, 13, "G", "G"]

actuals:
  - "%{subject}.north_captures"
  - "%{subject}.south_captures"
  - "%{subject}.squares"
  - "(%{subject} == Qi.new(*STARTING_POSITION_CONTEXT))"
  - "%{subject}.eql?(Qi.new(*STARTING_POSITION_CONTEXT))"
  - "%{subject}.current_captures"
  - "%{subject}.opponent_captures"
  - "%{subject}.current_turn"
  - "%{subject}.next_turn"
  - "%{subject}.north_turn?"
  - "%{subject}.south_turn?"
  - "%{subject}.options"
  - "%{subject}.to_a"
  - "%{subject}.to_h"
  - "%{subject}.hash"
  - "%{subject}.serialize"
  - "%{subject}.inspect"
